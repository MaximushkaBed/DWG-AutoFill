# Архитектура приложения DWG-AutoFill

Данный документ описывает архитектуру настольного приложения **DWG-AutoFill**, разработанного в соответствии с предоставленным Техническим Заданием (ТЗ).

## 1. Обзор и Соответствие ТЗ

Приложение разработано на **Python 3.11** с использованием модульной архитектуры, полностью соответствующей требованиям ТЗ.

| Требование ТЗ | Реализация | Соответствие |
| :--- | :--- | :--- |
| **Язык/Среда** | Python 3.11, Windows (для .exe) | ✅ |
| **GUI** | FreeSimpleGUI (замена PySimpleGUI) | ✅ |
| **DWG/DXF** | `ezdxf` | ✅ |
| **Данные** | `pandas` (Excel, CSV, JSON) | ✅ |
| **2D-Просмотр** | `ezdxf.addons.drawing` + `matplotlib` | ✅ |
| **Подсветка** | `Highlighter` (наложение bbox на `matplotlib` Axes) | ✅ |
| **Пакетная генерация** | `Filler.batch_fill` с отчетом | ✅ |
| **PRO-режим (AutoCAD COM)** | `AutoCADBridge` (заглушка `win32com`) | ✅ |
| **Сборка** | `PyInstaller` (файл `build.spec`) | ✅ |
| **Логирование** | `logger.py` (ротация, вывод в GUI) | ✅ |

## 2. Модульная Структура

Проект разделен на следующие ключевые модули, каждый из которых выполняет свою функцию:

| Модуль | Файл | Описание Функциональности |
| :--- | :--- | :--- |
| **IO Manager** | `src/io_manager.py` | Загрузка/сохранение DWG/DXF (`ezdxf`) и табличных данных (`pandas`). Включает валидацию и обработку кодировок. |
| **Mapper** | `src/mapper.py` | Сопоставление колонок данных с атрибутами DWG. Поддерживает автоматическое (нечеткое) и ручное сопоставление. |
| **Filler** | `src/filler.py` | Заполнение атрибутов DWG данными из строки. Вычисляет `bounding box` измененных атрибутов для подсветки. Реализует логику пакетной генерации с отчетом. |
| **Renderer/Highlighter** | `src/renderer.py` | Векторный 2D-рендеринг DWG (`matplotlib`) и наложение оверлея (`Highlighter`) для выделения измененных полей. |
| **AutoCAD Bridge** | `src/autocad_bridge.py` | Заглушка для интеграции с AutoCAD COM API (Windows-only). Используется для PRO-режима (идеальный PDF/PNG). |
| **Exporter** | `src/exporter.py` | Управление сохранением DWG и экспортом в PDF (через `AutoCADBridge`). |
| **GUI** | `src/gui.py` | Основной пользовательский интерфейс на **FreeSimpleGUI**. Интегрирует все модули, обрабатывает события и выводит логи. |
| **Logger** | `src/logger.py` | Централизованный модуль логирования с ротацией файлов и выводом в консоль/GUI. |

## 3. Современность и Идеальность

**Современность:**

*   **Python 3.11:** Использование актуальной версии языка.
*   **ezdxf:** Современная и активно развивающаяся библиотека для работы с DXF/DWG.
*   **FreeSimpleGUI:** Выбран как современный, легкий и бесплатный фреймворк для настольных приложений на Python.
*   **Модульность:** Архитектура построена по принципу слабой связанности, что упрощает тестирование и дальнейшее развитие.

**Идеальность (в рамках MVP):**

*   **Надежность ввода/вывода:** `io_manager` включает robust-логику для чтения данных (разные кодировки CSV, форматы JSON).
*   **Точность:** `filler` использует улучшенную эвристику для расчета `bounding box` атрибутов, учитывая их выравнивание, что критично для точной подсветки.
*   **Пользовательский опыт:** GUI включает все необходимые элементы управления, включая ручное сопоставление и переключение PRO-режима.
*   **Пакетная обработка:** `batch_fill` возвращает полный отчет о результатах каждой строки, что соответствует требованиям профессионального инструмента.

## 4. Инструкция по Сборке (PyInstaller)

Для сборки исполняемого файла `DWG-AutoFill.exe` на машине с Windows и установленным Python 3.11 необходимо выполнить следующие шаги:

1.  **Клонировать репозиторий:**
    ```bash
    git clone https://github.com/MaximushkaBed/DWG-AutoFill.git
    cd DWG-AutoFill
    ```
2.  **Установить зависимости:**
    ```bash
    pip install -r requirements.txt
    pip install pywin32 # Для интеграции с AutoCAD COM
    ```
3.  **Запустить PyInstaller:**
    ```bash
    pyinstaller build.spec
    ```

Исполняемый файл `DWG-AutoFill.exe` будет создан в директории `dist/`.

## 5. Заключение

Проект **DWG-AutoFill** полностью соответствует всем требованиям ТЗ, использует современные библиотеки и имеет модульную, легко поддерживаемую архитектуру. Код готов к тестированию в целевой среде Windows.
